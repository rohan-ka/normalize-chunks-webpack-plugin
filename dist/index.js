'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _toArray(a){return Array.isArray(a)?a:Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var _require=require('path'),resolve=_require.resolve,fs=require('fs'),mkdirp=require('mkdirp'),NormalizeChunksPlugin=function(){function a(b){_classCallCheck(this,a);var c={filename:'normalizeChunks.json',path:resolve(process.cwd(),'build')};this.options=Object.assign(c,b)}return _createClass(a,[{key:'apply',value:function apply(b){var c=this;b.plugin('emit',function(b,d){var e=b.getStats().toJson(),f=e.assetsByChunkName,g=a.createAssetMap(f),h=JSON.stringify(g);c.createBuildDirectory().then(function(){return c.writeToFile(h)}).then(function emitFile(){b.assets[c.options.filename]={source:function source(){return h},size:function size(){return h.length}}}).then(d)})}},{key:'createBuildDirectory',value:function createBuildDirectory(){var a=this;return new Promise(function(b,c){mkdirp(a.options.path,function(a){return a?c(a):b()})})}},{key:'writeToFile',value:function writeToFile(a){var b=this;return new Promise(function(c){var d=fs.createWriteStream(b.filename(),{mode:493});d.write(a,'utf-8',c)})}},{key:'filename',value:function(){var a=this.options,b=a.filename,c=a.path;return c+'/'+b}}],[{key:'createAssetMap',value:function createAssetMap(a){var b=function(a,b){var c=b.split('.'),d=_toArray(c),e=d[0],f=d[1],g=d.slice(2);return a[e+'.'+g.join('.')]=b,a};return Object.keys(a).map(function(b){return a[b]}).reduce(function buildLookup(a,c){var d={};return d=Array.isArray(c)?c.reduce(b,{}):b({},c),Object.assign({},a,d)},{})}}]),a}();module.exports=NormalizeChunksPlugin;